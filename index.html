<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./src/webix/webix.css" type="text/css" charset="utf-8">
    <script src="./src/webix/webix.js" type="text/javascript" charset="utf-8"></script>
    <script src="./src/webix/components/sidebar/sidebar.js"></script>
    <link rel="stylesheet" href="./src/webix/components/sidebar/sidebar.css">
    <script src="./src/data/data.js" charset="utf-8"></script>
</head>

<body>
    <script type="text/javascript" charset="utf-8">
    var selected = sdpData;
    var tab_data = tabData;
    var bm_data = bmData;
    var ev_data = eventData;
    var userPath = "src/img/zaichuk.jpg";
    var menu_data = [{
            id: "user",
            icon: "user",
            value: "Пользователь: Зайчук Алексей",
            link: "javascript:void(0)",
            data: [
                { id: "ui_status", value: "Admin", icon: "user-circle", link: "javascript:void(0)" },
                { id: "ui_mail", value: "Личные сообщения", icon: "envelope-o", badge: 4, link: "javascript:void(0)" },
                { id: "ui_settings", value: "Настройки профиля", icon: "cog", link: "javascript:void(0)" },
                { id: "ui_logout", value: "Выход", icon: "sign-out", link: "javascript:void(0)" }
            ]
        },
        {
            id: "ui",
            icon: "desktop",
            value: "Расширенный пользовательский интерфейс",
            link: "javascript:void(0)",
            data: [{
                    id: "ui_tabs",
                    value: "Закладки",
                    icon: "bookmark",
                    link: "javascript:void(0)"
                },
                {
                    id: "ui_start",
                    value: "Стартовая страница",
                    icon: "link",
                    link: "http://127.0.0.1:12345/index_sdp_premise_ps_icon.html"
                }
            ]
        },
        {
            id: "reports",
            icon: "table",
            value: "Отчеты",
            link: "javascript:void(0)",
            data: [
                { id: "balance", value: "Водный баланс", icon: "file" },
                { id: "nul", value: "Нулевое потребление", icon: "file" },
                { id: "cra", value: "Сходимость с ЦРА", icon: "file" },
                { id: "data", value: "Передача данных с ТПУ", icon: "file" },
                { id: "valid", value: "Валидация данных с ТПУ", icon: "file" },
                { id: "minus", value: "Отрицательная разница регистра", icon: "file" },
                { id: "minus_vol", value: "Отрицательные значения объема", icon: "file" },
                { id: "strange", value: "Нехарактерное потребление", icon: "file" },
                { id: "leaks", value: "Анализ потерь", icon: "file" }
            ]
        },
        { id: "trash", icon: "trash", value: "Корзина" }
    ];

    var form1 = {
        view: "form",
        borderless: false,
        scroll: true,
        elements: [

            {
                view: "checkbox",
                labelRight: "Адрес",
                id: "address_check",
                checkValue: "1address",
                uncheckValue: "0address",
                value: "1address",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Терр. сектор",
                id: "area_check",
                checkValue: "1area_sector",
                uncheckValue: "0area_sector",
                value: "1area_sector",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Абонент",
                id: "client_check",
                checkValue: "1client",
                uncheckValue: "0client",
                value: "1client",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Цвет",
                id: "color_check",
                checkValue: "1color",
                uncheckValue: "0color",
                value: "1color",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Район",
                id: "district_check",
                checkValue: "1district",
                uncheckValue: "0district",
                value: "1district",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "ИД Балтика",
                id: "id_baltica_check",
                checkValue: "1id_baltica",
                uncheckValue: "0id_baltica",
                value: "1id_baltica",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "ИД ЦРА",
                id: "id_cra_check",
                checkValue: "1id_cra",
                uncheckValue: "0id_cra",
                value: "1id_cra",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Уровень",
                id: "level_check",
                checkValue: "1level",
                uncheckValue: "0level",
                value: "1level",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Измеритель",
                id: "meter_check",
                checkValue: "1meter",
                uncheckValue: "0meter",
                value: "1meter",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Шина",
                id: "meter_bus_check",
                checkValue: "1meter_bus",
                uncheckValue: "0meter_bus",
                value: "1meter_bus",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Плейскод",
                id: "placecode_check",
                checkValue: "1placecode",
                uncheckValue: "0placecode",
                value: "1placecode",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Объект",
                id: "premise_check",
                checkValue: "1premise",
                uncheckValue: "0premise",
                value: "1premise",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "ДД",
                id: "pres_sensor_check",
                checkValue: "1pres_sensor",
                uncheckValue: "0pres_sensor",
                value: "1pres_sensor",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Насосная станция",
                id: "pumping_station_check",
                checkValue: "1pumping_station",
                uncheckValue: "0pumping_station",
                value: "1pumping_station",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Описание",
                id: "sdp_description_check",
                checkValue: "1sdp_description",
                uncheckValue: "0sdp_description",
                value: "1sdp_description",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Тех. сектор низ",
                id: "source_tech_sector_check",
                checkValue: "1source_tech_sector",
                uncheckValue: "0source_tech_sector",
                value: "1source_tech_sector",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Тех. сектор",
                id: "tech_sector_check",
                checkValue: "1tech_sector",
                uncheckValue: "0tech_sector",
                value: "1tech_sector",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Тип",
                id: "type_check",
                checkValue: "1type",
                uncheckValue: "0type",
                value: "1type",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "x",
                id: "x_check",
                checkValue: "1x",
                uncheckValue: "0x",
                value: "1x",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "y",
                id: "y_check",
                checkValue: "1y",
                uncheckValue: "0y",
                value: "1y",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            },
            {
                view: "checkbox",
                labelRight: "Зона",
                id: "zone_check",
                checkValue: "1zone",
                uncheckValue: "0zone",
                value: "1zone",
                labelWidth: 4,
                on: {
                    onChange: toggleColumn
                }
            }

        ],
        elementsConfig: {
            labelPosition: "top",
        }
    };


    webix.ui({
        view: "window",
        id: "win2",
        width: 300,
        height: 800,
        position: "center",
        modal: true,
        move: true,
        head: {
            rows: [{
                cols: [{ view: "label", label: "ВЫБЕРИТЕ СТОЛБЦЫ", align: "center" },
                    { view: "button", type: "icon", width: 30, css: "app_button", icon: "window-close", tooltip: "Закрыть", click: function() { $$("win2").hide() } }
                ]
            }, {
                cols: [{ view: "button", width: 150, tooltip: "Выбрать все", label: "Выбрать все", click: show_all },
                    { view: "button", width: 150, tooltip: "Снять все", label: "Снять все", click: hide_all }
                ]
            }]

        },
        body: webix.copy(form1)
    });
    webix.ui({
        rows: [{
                view: "toolbar",
                padding: 3,
                cols: [{
                        view: "button",
                        type: "icon",
                        icon: "bars",
                        width: 30,
                        tooltip: "Меню",
                        align: "left",
                        css: "app_button",
                        click: function() {
                            $$("$sidebar1").toggle()
                        }
                    },

                    { view: "label", label: "ПОРТАЛ ПОДСИСТЕМЫ ИЗМЕРЕНИЯ И УЧЕТА ГУП \"ВОДОКАНАЛ САНКТ-ПЕТЕРБУРГА\"", align: "right" },
                    { view: "button", type: "icon", icon: "server", width: 220, align: "right", disable: true },
                    { view: "search", width: 200, value: "Поиск" },
                    { view: "button", type: "icon", width: 35, css: "app_button", icon: "home", tooltip: "Домой" },
                    { view: "button", type: "icon", width: 35, css: "app_button", icon: "save", tooltip: "Сохранить" },
                    { view: "button", type: "icon", width: 45, css: "app_button", icon: "calendar", badge: 3, tooltip: "Расписание" },
                    { view: "button", type: "icon", width: 45, css: "app_button", icon: "envelope-o", badge: 4, tooltip: "Почта" },
                    {
                        view: "button",
                        type: "icon",
                        width: 45,
                        css: "app_button",
                        icon: "bell-o",
                        badge: 10,
                        tooltip: "События",
                        id: "alarm_button",
                        on: {
                            'onItemClick': change_tab
                        }
                    },
                    {
                        view: "button",
                        type: "icon",
                        width: 30,
                        css: "app_button",
                        icon: "users",
                        tooltip: "Управление пользователями",
                        id: "users_button",
                        on: {
                            'onItemClick': change_tab
                        }
                    },
                    { view: "button", type: "icon", width: 35, css: "app_button", icon: "cog", tooltip: "Настройки" },
                    { view: "button", type: "icon", width: 35, css: "app_button", icon: "sign-out", tooltip: "Выход", align: "right" }
                ]
            },
            {
                cols: [{
                        rows: [{ template: "<img hspace=60 src='src/img/zaichuk.jpg'/>", height: 250 }, {
                            view: "sidebar",
                            on: {
                                'onItemClick': change_tab
                            },
                            template: "{common.icon()}<a target='_blank' href='#link#' style='text-decoration: none; color: gray;'>#value#</a>",
                            data: menu_data,
                            width: 350,
                            select: false
                        }]

                    },
                    {
                        // type: "wide",
                        rows: [{
                                view: "tabview",
                                id: "tabViewInfo",
                                animate: true,
                                cells: [{
                                        header: "Закладки",
                                        width: 150,
                                        height: 1,
                                        body: {
                                            id: "bookmarks_tab",
                                            rows: [{
                                                    view: "datatable",
                                                    id: "bookmarks",
                                                    css: "rounded_top",
                                                    scrollX: true,
                                                    columns: tabColumns,
                                                    select: "row",
                                                    multiselect: true,
                                                    data: tab_data,
                                                    autoConfig: true,
                                                    resizeColumn: true
                                                },
                                                { view: "resizer" },
                                                {
                                                    cols: [
                                                        { gravity: 3 },
                                                        { view: "button", label: "Создать", type: "icon", icon: "plus-square", width: 100 },
                                                        {
                                                            view: "button",
                                                            label: "Удалить",
                                                            type: "icon",
                                                            icon: "trash",
                                                            width: 100,
                                                            click: function() {
                                                                $$("bookmarks").remove($$("bookmarks").getSelectedId());
                                                            }
                                                        },
                                                        { view: "button", label: "Дублировать", type: "icon", icon: "copy", width: 120 }
                                                    ]
                                                }
                                            ]

                                        }
                                    },
                                    {
                                        header: "Пользователи",
                                        width: 150,
                                        height: 1,
                                        body: {
                                            id: "users_tab",
                                            rows: [{
                                                view: "list",
                                                drag: true,
                                                multiselect: true,
                                                id: "list1",
                                                type: {
                                                    width: "auto",
                                                    height: "auto"
                                                },
                                                template: "#title#</br> Создан: #year#</br> Роль: #rank#",
                                                data: bm_data
                                            }, {
                                                cols: [
                                                    { gravity: 3 },
                                                    { view: "button", label: "Создать", type: "icon", icon: "plus-square", width: 100 },
                                                    { view: "button", label: "Удалить", type: "icon", icon: "trash", width: 100 },
                                                    { view: "button", label: "Дублировать", type: "icon", icon: "copy", width: 120 }
                                                ]
                                            }]

                                        }
                                    },
                                    {
                                        header: "События",
                                        width: 150,
                                        height: 1,
                                        body: {
                                            id: "events_tab",
                                            view: "datatable",
                                            css: "rounded_top",
                                            scrollX: true,
                                            columns: eventColumns,
                                            select: "row",
                                            multiselect: true,
                                            data: ev_data,
                                            autoConfig: true,
                                            resizeColumn: true
                                        }
                                    },
                                    {
                                        header: "Отчет",
                                        width: 150,
                                        height: 1,
                                        scroll: true,
                                        body: {
                                            id: "report_1",
                                            rows: [{
                                                    cols: [{

                                                        },
                                                        { view: "resizer" },
                                                        {
                                                            view: "form",
                                                            scroll: false,
                                                            width: 500,
                                                            scroll: true,
                                                            elements: form1
                                                        }
                                                    ]
                                                },
                                                { view: "resizer" },
                                                {
                                                    view: "datatable",
                                                    id: "masterdatatable",
                                                    css: "rounded_top",
                                                    scrollX: true,
                                                    columns: gridColumns,
                                                    select: "row",
                                                    multiselect: true,
                                                    data: selected,
                                                    autoConfig: true,
                                                    resizeColumn: true,
                                                    drag: true
                                                },
                                                {
                                                    cols: [
                                                        { gravity: 3 },
                                                        {
                                                            view: "button",
                                                            label: "Сохранить в файл",
                                                            width: 150,
                                                            click: function() {
                                                                webix.toExcel($$("masterdatatable"),{ignore: { "checked":true}});
                                                            }
                                                        },
                                                        { view: "button", label: "Выбрать столбцы", width: 150, click: function() { $$("win2").show() } }
                                                    ]
                                                }
                                            ]

                                        }
                                    },


                                ]
                            }

                        ]
                    }

                ]
            }
        ]
    });


    function hide_all() {
        form1.elements.forEach(function(entry) {
            var state = parseInt($$(entry.id).getValue().substr(0, 1));
            var col_id = $$(entry.id).getValue().substr(1);
            if ($$("masterdatatable").isColumnVisible(col_id) == true && state == 1) {
                console.log(col_id + " " + $$("masterdatatable").isColumnVisible(col_id));
                console.log("hide_all");
                $$(entry.id).toggle();
            }
        })
    };

    function show_all() {
        form1.elements.forEach(function(entry) {
            var state = parseInt($$(entry.id).getValue().substr(0, 1));
            var col_id = $$(entry.id).getValue().substr(1);
            if ($$("masterdatatable").isColumnVisible(col_id) == false && state == 0) {
                console.log(col_id + " " + $$("masterdatatable").isColumnVisible(col_id));
                console.log("show_all");
                $$(entry.id).toggle();
            }
        })
    };






    function toggleColumn(id) {
        // console.log(this.getParentView())
        var col_id = id.substr(1);
        var state = parseInt(id.substr(0, 1));
        console.log(col_id); //this.getValue());
        if ($$("masterdatatable").isColumnVisible(col_id) && state == 0) {
            console.log("hide_toogle")
            $$("masterdatatable").hideColumn(col_id, { spans: true });
        } else {
            console.log("show_toogle")
            $$("masterdatatable").showColumn(col_id, { spans: true });
        }
    }

    // Функция открывает вкладку "Закладка"
    function change_tab(id) {
        console.log(id);
        if (id == "ui_tabs") {
            console.log("Закладки");
            $$("tabViewInfo").getTabbar().setValue("bookmarks_tab");
        } else if (id == "users_button") {
            console.log("Пользователи");
            $$("tabViewInfo").getTabbar().setValue("users_tab");
        } else if (id == "alarm_button") {
            console.log("Пользователи");
            $$("tabViewInfo").getTabbar().setValue("events_tab");
        }
    };
    </script>
</body>

</html>